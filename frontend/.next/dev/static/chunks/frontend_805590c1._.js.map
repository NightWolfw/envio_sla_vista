{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Bots/Git/envio_sla_vista/frontend/lib/client.ts"],"sourcesContent":["\"use client\";\n\nconst API_BASE = process.env.NEXT_PUBLIC_API_BASE_URL ?? \"http://localhost:5000/api\";\n\ntype Method = \"GET\" | \"POST\" | \"PUT\" | \"DELETE\";\n\nasync function request<T>(path: string, method: Method, body?: unknown): Promise<T> {\n  const res = await fetch(`${API_BASE}${path}`, {\n    method,\n    headers: {\n      \"Content-Type\": \"application/json\"\n    },\n    body: body ? JSON.stringify(body) : undefined\n  });\n\n  if (!res.ok) {\n    const text = await res.text();\n    throw new Error(text || `Erro ${res.status}`);\n  }\n\n  if (res.status === 204) {\n    return {} as T;\n  }\n\n  return res.json() as Promise<T>;\n}\n\nexport const clientApi = {\n  put: <T>(path: string, body?: unknown) => request<T>(path, \"PUT\", body),\n  post: <T>(path: string, body?: unknown) => request<T>(path, \"POST\", body),\n  delete: <T>(path: string, body?: unknown) => request<T>(path, \"DELETE\", body)\n};\n"],"names":[],"mappings":";;;;AAEiB;AAFjB;AAEA,MAAM,WAAW,uLAAO,CAAC,GAAG,CAAC,wBAAwB,IAAI;AAIzD,eAAe,QAAW,IAAY,EAAE,MAAc,EAAE,IAAc;IACpE,MAAM,MAAM,MAAM,MAAM,GAAG,WAAW,MAAM,EAAE;QAC5C;QACA,SAAS;YACP,gBAAgB;QAClB;QACA,MAAM,OAAO,KAAK,SAAS,CAAC,QAAQ;IACtC;IAEA,IAAI,CAAC,IAAI,EAAE,EAAE;QACX,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,IAAI,MAAM,QAAQ,CAAC,KAAK,EAAE,IAAI,MAAM,EAAE;IAC9C;IAEA,IAAI,IAAI,MAAM,KAAK,KAAK;QACtB,OAAO,CAAC;IACV;IAEA,OAAO,IAAI,IAAI;AACjB;AAEO,MAAM,YAAY;IACvB,KAAK,CAAI,MAAc,OAAmB,QAAW,MAAM,OAAO;IAClE,MAAM,CAAI,MAAc,OAAmB,QAAW,MAAM,QAAQ;IACpE,QAAQ,CAAI,MAAc,OAAmB,QAAW,MAAM,UAAU;AAC1E"}},
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///C:/Bots/Git/envio_sla_vista/frontend/app/envio/form.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState } from \"react\";\nimport type { EnvioGrupo } from \"../../lib/api\";\nimport { clientApi } from \"../../lib/client\";\n\ntype Props = {\n  grupos: EnvioGrupo[];\n};\n\ntype EnvioResposta = {\n  sucessos: number;\n  erros: number;\n  detalhes: Array<{\n    grupo: string;\n    group_id: string;\n    sucesso: boolean;\n    erro?: string | null;\n  }>;\n};\n\nexport default function EnvioForm({ grupos }: Props) {\n  const [status, setStatus] = useState<string | null>(null);\n  const [detalhes, setDetalhes] = useState<EnvioResposta[\"detalhes\"] | null>(null);\n  const [loading, setLoading] = useState(false);\n\n  async function handleSubmit(event: React.FormEvent<HTMLFormElement>) {\n    event.preventDefault();\n    const form = new FormData(event.currentTarget);\n    const mensagem = form.get(\"mensagem\") as string;\n    const gruposSelecionados = form.getAll(\"grupos\") as string[];\n\n    if (!mensagem.trim() || !gruposSelecionados.length) {\n      setStatus(\"Preencha a mensagem e selecione pelo menos um grupo.\");\n      return;\n    }\n\n    setLoading(true);\n    setStatus(null);\n    setDetalhes(null);\n\n    try {\n      const resposta = await clientApi.post<EnvioResposta>(\"/envio/processar\", {\n        mensagem,\n        grupos_ids: gruposSelecionados\n      });\n      setStatus(\n        `Envios concluídos: ${resposta.sucessos} sucesso(s), ${resposta.erros} erro(s).`\n      );\n      setDetalhes(resposta.detalhes);\n      event.currentTarget.reset();\n    } catch (error: any) {\n      setStatus(error.message ?? \"Falha ao enviar mensagens\");\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  return (\n    <form className=\"grid\" style={{ gap: \"1rem\" }} onSubmit={handleSubmit}>\n      <label>\n        Mensagem\n        <textarea name=\"mensagem\" rows={5} required placeholder=\"Digite a mensagem a enviar\" />\n      </label>\n\n      <label>\n        Grupos (segure Ctrl/Cmd para selecionar múltiplos)\n        <select name=\"grupos\" multiple required size={Math.min(grupos.length, 10)}>\n          {grupos.map((grupo) => (\n            <option key={grupo.group_id} value={grupo.group_id}>\n              {grupo.nome_grupo} ({grupo.group_id})\n            </option>\n          ))}\n        </select>\n      </label>\n\n      <button type=\"submit\" disabled={loading}>\n        {loading ? \"Enviando...\" : \"Enviar mensagem\"}\n      </button>\n\n      {status && <p style={{ margin: 0 }}>{status}</p>}\n\n      {detalhes && (\n        <div className=\"panel\" style={{ marginTop: \"1rem\" }}>\n          <h3>Detalhes</h3>\n          <table>\n            <thead>\n              <tr>\n                <th>Grupo</th>\n                <th>ID</th>\n                <th>Status</th>\n                <th>Erro</th>\n              </tr>\n            </thead>\n            <tbody>\n              {detalhes.map((item) => (\n                <tr key={item.group_id}>\n                  <td>{item.grupo}</td>\n                  <td>{item.group_id}</td>\n                  <td>{item.sucesso ? \"SUCESSO\" : \"ERRO\"}</td>\n                  <td>{item.erro ?? \"—\"}</td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>\n      )}\n    </form>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AAEA;;;AAJA;;;AAqBe,SAAS,UAAU,EAAE,MAAM,EAAS;;IACjD,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,qLAAQ,EAAgB;IACpD,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,qLAAQ,EAAmC;IAC3E,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,qLAAQ,EAAC;IAEvC,eAAe,aAAa,KAAuC;QACjE,MAAM,cAAc;QACpB,MAAM,OAAO,IAAI,SAAS,MAAM,aAAa;QAC7C,MAAM,WAAW,KAAK,GAAG,CAAC;QAC1B,MAAM,qBAAqB,KAAK,MAAM,CAAC;QAEvC,IAAI,CAAC,SAAS,IAAI,MAAM,CAAC,mBAAmB,MAAM,EAAE;YAClD,UAAU;YACV;QACF;QAEA,WAAW;QACX,UAAU;QACV,YAAY;QAEZ,IAAI;YACF,MAAM,WAAW,MAAM,yIAAS,CAAC,IAAI,CAAgB,oBAAoB;gBACvE;gBACA,YAAY;YACd;YACA,UACE,CAAC,mBAAmB,EAAE,SAAS,QAAQ,CAAC,aAAa,EAAE,SAAS,KAAK,CAAC,SAAS,CAAC;YAElF,YAAY,SAAS,QAAQ;YAC7B,MAAM,aAAa,CAAC,KAAK;QAC3B,EAAE,OAAO,OAAY;YACnB,UAAU,MAAM,OAAO,IAAI;QAC7B,SAAU;YACR,WAAW;QACb;IACF;IAEA,qBACE,yMAAC;QAAK,WAAU;QAAO,OAAO;YAAE,KAAK;QAAO;QAAG,UAAU;;0BACvD,yMAAC;;oBAAM;kCAEL,yMAAC;wBAAS,MAAK;wBAAW,MAAM;wBAAG,QAAQ;wBAAC,aAAY;;;;;;;;;;;;0BAG1D,yMAAC;;oBAAM;kCAEL,yMAAC;wBAAO,MAAK;wBAAS,QAAQ;wBAAC,QAAQ;wBAAC,MAAM,KAAK,GAAG,CAAC,OAAO,MAAM,EAAE;kCACnE,OAAO,GAAG,CAAC,CAAC,sBACX,yMAAC;gCAA4B,OAAO,MAAM,QAAQ;;oCAC/C,MAAM,UAAU;oCAAC;oCAAG,MAAM,QAAQ;oCAAC;;+BADzB,MAAM,QAAQ;;;;;;;;;;;;;;;;0BAOjC,yMAAC;gBAAO,MAAK;gBAAS,UAAU;0BAC7B,UAAU,gBAAgB;;;;;;YAG5B,wBAAU,yMAAC;gBAAE,OAAO;oBAAE,QAAQ;gBAAE;0BAAI;;;;;;YAEpC,0BACC,yMAAC;gBAAI,WAAU;gBAAQ,OAAO;oBAAE,WAAW;gBAAO;;kCAChD,yMAAC;kCAAG;;;;;;kCACJ,yMAAC;;0CACC,yMAAC;0CACC,cAAA,yMAAC;;sDACC,yMAAC;sDAAG;;;;;;sDACJ,yMAAC;sDAAG;;;;;;sDACJ,yMAAC;sDAAG;;;;;;sDACJ,yMAAC;sDAAG;;;;;;;;;;;;;;;;;0CAGR,yMAAC;0CACE,SAAS,GAAG,CAAC,CAAC,qBACb,yMAAC;;0DACC,yMAAC;0DAAI,KAAK,KAAK;;;;;;0DACf,yMAAC;0DAAI,KAAK,QAAQ;;;;;;0DAClB,yMAAC;0DAAI,KAAK,OAAO,GAAG,YAAY;;;;;;0DAChC,yMAAC;0DAAI,KAAK,IAAI,IAAI;;;;;;;uCAJX,KAAK,QAAQ;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAatC;GAxFwB;KAAA"}}]
}